# SmartSeating

SmartSeating 是一个使用 .NET 10 与 WPF 构建的智能排座桌面应用。它面向班主任或培训讲师，帮助快速导入学生名单、规划教室座位、并根据学生偏好、身高、亲疏关系等条件生成合理的座位方案。

## 功能概览

- **可视化座位编辑**：支持自定义行列数、框选多选、右键上下文菜单以及键盘快捷键（`F` 固定、`D` 禁用、`Delete` 删除学生）。
- **学生管理面板**：左侧列表可搜索、双击即可分配到首选座位，并可一键定位其座位。列表下方实时展示已安排/待安排统计信息。
- **智能排座**：内置模拟退火启发式算法，综合身高、重要程度、亲疏关系、偏好区域等因素来寻找低冲突方案。
- **数据导入导出**：支持从 Excel 导入学生名单、导出座位表到 Excel、导出/导入 JSON 配置、导出 PNG 座位图。
- **可视化图例与状态**：右侧面板提供座位颜色图例与当前座位概况（总数、固定、禁用、剩余空位）。
- **自动保存**：应用启动时自动尝试加载上次的 `SeatingConfig.json`，关闭时自动保存，避免数据丢失。

## 运行环境

- Windows 11/10（需要桌面环境）
- [.NET SDK 10.0](https://dotnet.microsoft.com/) 或更高版本
- 推荐使用 Visual Studio 2022 17.8+ / JetBrains Rider / VS Code + C# Dev Kit

## 构建与运行

```bash
# 还原依赖并构建
 dotnet restore SmartSeating.slnx
 dotnet build SmartSeating.slnx

# 启动（也可直接在 IDE 中调试）
 dotnet run --project SmartSeating/SmartSeating.csproj
```

> 本仓库在无 GUI 的 CI 环境中无法实际启动 WPF 窗口，以上命令需在具备图形界面的 Windows 机器上运行。

## 使用指南

1. **设置教室规模**：在顶部输入行列数后点击“应用尺寸”。
2. **导入学生**：可从 Excel 名单导入或手动在右侧输入学生姓名与偏好。导入操作会清空当前排座。
3. **管理学生**：在左侧搜索框输入关键字即可筛选学生；选中后可以点击“分配到所选座位”或双击快速放置。`定位学生座位`按钮可自动滚动至该学生所在座位。
4. **编辑座位**：点击座位查看详情，可设置固定/禁用、编辑学生属性。框选可批量操作，右键菜单可批量禁用/固定/清空。
5. **智能排座**：点击“智能排座”开始模拟退火优化。进度条与遮罩会提示正在计算，完成后结果会写回画布。
6. **导出成果**：根据需要导出 JSON、Excel 或 PNG，便于分享与打印。

## 数据格式说明

- **Excel 导入**：第一列从 A1 开始，每行一个学生姓名。
- **JSON 配置**：`SeatingConfig.json` 保存了行列数量、所有学生属性，以及每个座位的状态（固定、禁用、学生姓名）。
- **偏好区域**：格式为 `R1,C1-R2,C2` 或 `R,C`，表示学生希望坐在的行列范围。

## 代码结构

- `SmartSeating/App.xaml`：应用入口与资源字典。
- `SmartSeating/MainWindow.xaml`：主界面布局（学生列表、画布、详情面板、图例等）。
- `SmartSeating/MainWindow.xaml.cs`：核心逻辑，包括座位绘制、导入导出、智能排座算法、学生筛选/分配、状态统计等。

如需二次开发，可重点关注 `MainWindow.xaml.cs` 中的数据模型（`Student`、`Seat`、`SeatingConfiguration`）以及 `CalculateCost` 函数的权重设计。
